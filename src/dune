(rule
 (targets liblab_tools.a dlllab_tools.so)
 (deps (glob_files *.rs))
 (action
  (progn
   (run cargo build --target-dir %{project_root}/../../target --release)
   (run sh -c
     "mv %{project_root}/../../target/release/liblab_tools.so ./dlllab_tools.so 2> /dev/null || \
      mv %{project_root}/../../target/release/liblab_tools.dylib ./dlllab_tools.so")
   (run mv %{project_root}/../../target/release/liblab_tools.a liblab_tools.a))))

(executable
 (name Main)
 (public_name lab-tools)
 (modules Main CodeGen Rosters Common Data Config)
 (libraries containers csv)
 (foreign_archives lab_tools))
